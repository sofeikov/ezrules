{% include "user_header.html" %}
{% extends "layout.html" %}
{% block head %}
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous">
    </script>
    <title>Upload Transaction Labels</title>
    <style>
        .container-fluid {
            padding-left: 15px;
            padding-right: 15px;
        }
    </style>
</head>
{% endblock %}
{% block body %}
<body>
    <div class="container-fluid mt-3">
        <a href="{{ url_for('rules') }}" class="btn btn-secondary mb-3">Back to rule list</a>
        <h1>Upload Transaction Labels</h1>
        <p>Upload a CSV file to bulk mark events with labels for analytical purposes.</p>

        <div class="alert alert-info" role="alert">
            <h5>CSV Format Requirements:</h5>
            <ul>
                <li>The CSV file must contain exactly 2 columns: <strong>event_id,label_name</strong></li>
                <li>No header row required</li>
                <li>Label names will be automatically converted to uppercase</li>
                <li>Labels must already exist in the system (manage them <a href="{{ url_for('label_management') }}">here</a>)</li>
                <li>Events must have been previously processed through the evaluator</li>
            </ul>
            <strong>Example CSV content:</strong>
            <pre>event_123,FRAUD
event_456,NORMAL
event_789,CHARGEBACK</pre>
        </div>

        <div class="card mb-3">
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {{ form.csrf_token }}
                    <div class="mb-3">
                        {{ form.csv_file.label(class="form-label") }}
                        {{ form.csv_file(class="form-control", accept=".csv") }}
                        {% if form.csv_file.errors %}
                            <div class="text-danger">
                                {% for error in form.csv_file.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    {{ form.submit(class="btn btn-primary") }}
                </form>
            </div>
        </div>
    </div>
</body>
{% endblock %}